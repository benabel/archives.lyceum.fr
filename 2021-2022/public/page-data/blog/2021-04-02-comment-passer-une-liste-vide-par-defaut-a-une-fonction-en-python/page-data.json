{"componentChunkName":"component---src-templates-blog-md-js","path":"/blog/2021-04-02-comment-passer-une-liste-vide-par-defaut-a-une-fonction-en-python/","result":{"data":{"markdownRemark":{"html":"<h2 id=\"le-problème\" style=\"position:relative;\"><a href=\"#le-probl%C3%A8me\" aria-label=\"le problème permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Le problème</h2>\n<p>Il est parfois nécessaire de passer des informations lors d'appels de\nfonctions récursifs.</p>\n<p>Par exemple, en tentant d'implémenter la <span><a href=\"/2021-2022/tg/nsi/5-algorithmique/2-algorithmes-sur-les-graphes#rep%C3%A9rer-la-pr%C3%A9sence-dun-cycle\">recherche d'un cycle\ndans un\ngraphe</a></span>\nje souhaitais passer une liste de noeuds déjà visités au rappel de la\nfonction pour détecter le cycle. En donnant une liste vide comme valeur\npar défaut je pensais pourvoir m'affranchir du rajout de la liste aux\narguments lors de appels.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">recherche_cycle</span><span class=\"token punctuation\">(</span>graph<span class=\"token punctuation\">,</span> noeud<span class=\"token punctuation\">,</span> vus<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Aurait pu s'appeler <code class=\"language-text\">recherche_cycle(g, n)</code> et non\n<code class=\"language-text\">recherche_cycle(g, n, [])</code>. Cependant seule la deuxième forme\nfonctionnait car la liste <code class=\"language-text\">vus</code> n'était pas <em>réinitialisée</em> entre deux\nappels.</p>\n<p><strong>Etrange non?</strong></p>\n<p>voici un exemple minimal pour comprendre ce qui se passe.</p>\n<hr>\n<div class=\"card text-white bg-gradient-dark\">\n<div class=\"card-header\">\n<p><small class=\"text-muted\">Entrée</small></p>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">def</span> liste_vide_par_défaut<span class=\"token punctuation\">(</span>vus<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"valeur de vus au moment de l'appel:\"</span><span class=\"token punctuation\">,</span> vus<span class=\"token punctuation\">)</span>\n    vus<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>i <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</div>\n<div class=\"card text-white bg-gradient-light stream-output\">\n<div class=\"card-header\">\n<p><small class=\"text-muted\">Sortie</small></p>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">valeur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: [0, 1, 2, 3]\nvaleur de vus au moment de l'appel: [0, 1, 2, 3, 0, 1, 2, 3]\nvaleur de vus au moment de l'appel: [0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3]</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</div>\n<hr>\n<p>Ainsi la liste ne prend pas sa valeur par défaut à chaque appel, mais\n<strong>quand la définition de la fonction est executée.</strong></p>\n<p>Voici le déroulement de cette suite d'instructions dans\n<span><a href=\"http://pythontutor.com/\">pytutor</a></span>:</p>\n<p><span><img src=\"/2021-2022/22475d9c714361c11cdae6ad100e02c9/pytutor-liste.gif\" alt=\"Python tutor liste\" title=\"fig:\"></span></p>\n<p>La\n<span><a href=\"https://docs.python.org/fr/3/reference/compound_stmts.html#function-definitions\">documentation</a></span>\nprécise:</p>\n<blockquote>\n<p>Les valeurs par défaut des paramètres sont évaluées de la gauche vers\nla droite quand la définition de la fonction est exécutée. Cela\nsignifie que l'expression est évaluée une fois, lorsque la fonction\nest définie, et que c'est la même valeur « pré-calculée » qui est\nutilisée à chaque appel. C'est particulièrement important à comprendre\nlorsqu'un paramètre par défaut est un objet mutable, tel qu'une liste\nou un dictionnaire : si la fonction modifie l'objet (par exemple en\najoutant un élément à une liste), la valeur par défaut est modifiée.\nEn général, ce n'est pas l'effet voulu.</p>\n</blockquote>\n<h2 id=\"la-solution\" style=\"position:relative;\"><a href=\"#la-solution\" aria-label=\"la solution permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>La solution</h2>\n<p>La solution préconisée est d'utiliser <code class=\"language-text\">None</code> par défaut et de tester\nexplicitement la valeur dans le corps de la fonction.</p>\n<hr>\n<div class=\"card text-white bg-gradient-dark\">\n<div class=\"card-header\">\n<p><small class=\"text-muted\">Entrée</small></p>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">def</span> liste_vide_par_défaut<span class=\"token punctuation\">(</span>vus<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> vus <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n        vus <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"valeur de vus au moment de l'appel:\"</span><span class=\"token punctuation\">,</span> vus<span class=\"token punctuation\">)</span>\n    vus<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>i <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nliste_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</div>\n<div class=\"card text-white bg-gradient-light stream-output\">\n<div class=\"card-header\">\n<p><small class=\"text-muted\">Sortie</small></p>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">valeur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: []</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</div>\n<hr>\n<h2 id=\"quand-utiliser-cette-solution\" style=\"position:relative;\"><a href=\"#quand-utiliser-cette-solution\" aria-label=\"quand utiliser cette solution permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quand utiliser cette solution?</h2>\n<p>Il faut bien comprendre que cette solution n'est nécessaire que lorsque\nle paramètre par défaut est mutable (listes, dictionnaire notamment).</p>\n<p>Un objet non mutable étant par construction non modifiable gradera la\nvaleur qui lui a été donnée par défaut lors de la <em>définition de la\nfonction</em>.</p>\n<hr>\n<div class=\"card text-white bg-gradient-dark\">\n<div class=\"card-header\">\n<p><small class=\"text-muted\">Entrée</small></p>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">def</span> str_vide_par_défaut<span class=\"token punctuation\">(</span>txt<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"valeur de txt au moment de l'appel:\"</span><span class=\"token punctuation\">,</span> txt<span class=\"token punctuation\">)</span>\n    txt <span class=\"token operator\">=</span> txt <span class=\"token operator\">+</span> <span class=\"token string\">\"0123\"</span>\nstr_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nstr_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nstr_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nstr_vide_par_défaut<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</div>\n<div class=\"card text-white bg-gradient-light stream-output\">\n<div class=\"card-header\">\n<p><small class=\"text-muted\">Sortie</small></p>\n</div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">valeur de txt au moment de l'appel: \nvaleur de txt au moment de l'appel: \nvaleur de txt au moment de l'appel: \nvaleur de txt au moment de l'appel: </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n</div>\n<hr>\n<p>Voici le déroulement de cette suite d'instructions dans\n<span><a href=\"http://pythontutor.com/\">pytutor</a></span>:</p>\n<p><span><img src=\"/2021-2022/5c900aabcda474e6c6c500a6347d7664/pytutor-str.gif\" alt=\"Python tutor liste\" title=\"fig:\"></span></p>\n<p>Une chaîne de caractère étant immutable, l'argument par défaut reste\nvide.</p>","tableOfContents":"<ul>\n<li><a href=\"#le-probl%C3%A8me\">Le problème</a></li>\n<li><a href=\"#la-solution\">La solution</a></li>\n<li><a href=\"#quand-utiliser-cette-solution\">Quand utiliser cette solution?</a></li>\n</ul>","timeToRead":3,"fields":{"slug":"blog/2021-04-02-comment-passer-une-liste-vide-par-defaut-a-une-fonction-en-python/"},"frontmatter":{"author":"Benjamin Abel","tags":["python","fonction","paramètre optionnel","liste"],"title":"Comment passer une liste vide par défaut à une fonction en Python?","date":"2021-04-02T00:00:00.000Z"}}},"pageContext":{"slug":"blog/2021-04-02-comment-passer-une-liste-vide-par-defaut-a-une-fonction-en-python/"}},"staticQueryHashes":["604483588"]}