<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.146">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>cours</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="cours_files/libs/clipboard/clipboard.min.js"></script>
<script src="cours_files/libs/quarto-html/quarto.js"></script>
<script src="cours_files/libs/quarto-html/popper.min.js"></script>
<script src="cours_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cours_files/libs/quarto-html/anchor.min.js"></script>
<link href="cours_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cours_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cours_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cours_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cours_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<details class="programme"><summary>Programme Officiel</summary>
<table class="table table-bordered table-hover">
<thead class="table-warning">
<tr class="header">
<th>Contenus</th>
<th>Capacités attendues</th>
<th>Commentaires</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Modèle d’architecture séquentielle (von Neumann)</td>
<td>Dérouler l’exécution d’une séquence d’instructions simples du type langage machine.</td>
<td>Des activités débranchées sont proposées.</td>
</tr>
</tbody>
</table>
<a class="lien-programme" href="../programme/">Lien vers le programme complet</a></details>

<div class="intro">
<p>Maintenant que nous avons vu quelle était la structure générale d’un ordinateur, nous allons nous intéresser plus précisément au rôle du processeur et de la mémoire(vive), et voir comment peuvent être dictées les instructions à l’unité de contrôle du processeur.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/vnsim.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Copie d’écran de la simulation de Von Neumann utilisée.</figcaption><p></p>
</figure>
</div>
</div>
<h2 id="les-divers-éléments-de-la-simulation" class="anchored">Les divers éléments de la simulation</h2>
<p>On utilisera dans ce cours une version modifiée de la simulation de Lorenzo Gianni sous licence MIT.</p>
<p><a href="https://apps.lyceum.fr/vnsim" class="uri">https://apps.lyceum.fr/vnsim</a></p>
<p>Outre la RAM, le processeur ne possède qu’un très petit nombre de cases mémoires très rapides appelées des <em>registres</em> dont la capacité dépasse rarement quelques dizaines d’octets pour des raisons de coût et de place. <a href="https://fr.wikipedia.org/wiki/Registre_de_processeur">Source Wikipédia</a></p>
<h3 id="la-mémoire-ram" class="anchored">La mémoire (RAM)</h3>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>La mémoire vive contient plusieurs milliards de circuits mémoires un bit, qui sont organisés en <em>cases mémoires</em> de huit, seize, trente-deux, soixante-quatre bits. Chaque case a une <em>adresse</em> unique, leur nombre détermine la capacité de la mémoire vive de l’ordinateur.</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/vn-mem.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">La mémoire est située à droite est séparée en deux parties: le programme et ses instructions à gauche(adresses 0 à 99) et les variables(adresses 100 et suivantes) avec leurs données à droite.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<h3 id="lunité-de-commande-ri-et-cp" class="anchored">L’unité de commande (RI et CP)</h3>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="left quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>L’unité de commande contient <em>deux registres</em> pour stocker son état d’exécution:</p>
<ul>
<li>Le registre d’instruction (RI) stocke l’instruction du programme provenant de la mémoire programme actuellement exécutée.</li>
<li>Le compteur de programme stocke la ligne du programme actuellement exécutée, après son exécution ce compteur est incrémenté de 1 (sauf en cas de saut: <code>JMP</code>).</li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/vn-uc.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">L’unité de commande possède deux registres: le registre d’instructions et le compteur de programme.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<h3 id="lunité-arithmétique-et-logique-ual" class="anchored">L’unité arithmétique et logique (UAL)</h3>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="left quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p>L’unité arithmétique et logique est composée de transistors assemblés de façon à lui permettre de réaliser un <em>petit nombre d’opérations simples (arithmétique: + -, logique booléenne: &amp; | !), mais à réaliser ces opérations très rapidement</em>.</p>
<p>Le résultat des opérations est stocké dans un <em>registre</em> appelé accumulateur (ACC).</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/vn-ual.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Le résultat des opérations des circuits calculatoires de l’UAL est stocké dans l’accumulateur pour l’exécution de calculs ultérieurs ou pour être renvoyé vers la mémoire.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<h2 id="programmer-en-assembleur" class="anchored">Programmer en assembleur</h2>
<p>Les cellules mémoire du programme sont stockées sous forme binaire, on les représente cependant sous forme textuelle. Un compilateur les convertit ensuite sous forme binaire pour les stocker dans la mémoire programme. Cette représentation textuelle est appelée le <em>langage assembleur</em>.</p>
<p>Le jeu d’instructions de notre simulateur est résumé ci-dessous.</p>
<table class="table table-bordered table-hover">
<thead class="table-warning">
<tr class="header">
<th colspan="3"> Accès mémoire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>LOAD var / LOAD #nb</code></td>
<td>Transfère dans l’accumulateur la valeur de la variable <code>var</code> présente dans la mémoire ou directement le nombre <code>nb</code>.</td>
<td></td>
</tr>
<tr class="even">
<td><code>STORE var</code></td>
<td>Transfère le contenu de l’accumulateur dans l’adresse mémoire associée à la variable <code>var</code>.<br>
</td>
<td></td>
</tr>
</tbody>
</table>
<details class="appli"><summary>&nbsp;</summary>
<p>Écrire un programme qui permet de stocker quatre valeurs 2, 3, 5, 7 dans les cases mémoires d’adresse 100(variable X), 101(Y), 102(Z), 103(W).</p>
<p><em>Ne pas oublier d’ajouter l’instruction <code>HALT</code> en fin du programme pour arrêter l’incrémentation du CP.</em></p>
<!--
// Affectation des variables
LOAD #2
STORE X
LOAD #3
STORE Y
LOAD #5
STORE Z
LOAD #7
STORE W
HALT
-->
</details>

<table class="table table-bordered table-hover">
<thead class="table-warning">
<tr class="header">
<th colspan="2"> Opérations arithmétiques</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ADD var / ADD #nb</code></td>
<td><em>Additionne</em> au contenu de l’accumulateur la valeur de la variable <code>var</code> de la mémoire ou directement le nombre <code>nb</code> et renvoie dans l’accumulateur le résultat.</td>
</tr>
<tr class="even">
<td><code>SUB var / SUB #nb</code></td>
<td><em>Soustrait</em> au contenu de l’accumulateur la valeur de la variable <code>var</code> de la mémoire ou directement le nombre <code>nb</code> et renvoie dans l’accumulateur le résultat.</td>
</tr>
</tbody>
</table>
<details class="appli"><summary>&nbsp;</summary>
<p>Compléter le programme de l’application précédente pour additionner les quatre nombres contenus dans les cases mémoires X, Y, Z et W et de stocker le résultat de cette addition dans la case mémoire 104(N).</p>
<!-- 
// Addition
LOAD X
ADD Y
ADD Z
ADD W
STORE N
HALT
-->
</details>

<table class="table table-bordered table-hover">
<thead class="table-warning">
<tr class="header">
<th colspan="3"> Opération logique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>CMP adr / CMP #nb</code></td>
<td>Compare le contenu de l’accumulateur à la valeur de la variable <code>var</code> de la mémoire ou au nombre <code>nb</code> et renvoie dans l’accumulateur le résultat -1,0 ou 1 selon le résultat de la comparaison: inférieur, égal ou supérieur.</td>
<td></td>
</tr>
</tbody>
</table>
<details class="appli"><summary>&nbsp;</summary>
<p>Compléter le programme de l’application précédente pour comparer le contenu des cases mémoires X et N et de stocker le résultat de cette comparaison dans la case mémoire 6(R).</p>
<!-- 
// Comparaison
LOAD X
CMP N
STORE R
HALT
-->
</details>

<div class="callout callout-style-default callout-tip callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Ajouter des étiquettes aux lignes du programme
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour pouvoir réaliser des boucles ou sauter des lignes en fonction de conditions, on utilise des instructions de saut <code>JMP</code> qui permettront de se déplacer vers une ligne spécifique du programme ou vers une ligne précédée d’une étiquette <code>inf: LOAD X</code> ici l’étiquette est <code>inf</code> on peut s’y rendre avec <code>JMP inf</code>.</p>
</div>
</div>
<table class="table table-bordered table-hover">
<thead class="table-warning">
<tr class="header">
<th colspan="3"> Contrôle du programme: Conditions, boucles, commentaires…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>JMP étiquette / JMP n</code></td>
<td>Transfère dans le compteur de programme <em>CP</em> le numéro de ligne <code>n</code> ou le numéro de la ligne avec l’étiquette <code>étiquette</code>.</td>
<td></td>
</tr>
<tr class="even">
<td><code>JMPZ étiquette / JMPZ n</code></td>
<td>Transfère <strong>uniquement si le contenu de l’accumulateur est nul</strong> dans le compteur de programme <em>CP</em> le numéro de ligne <code>n</code> ou le numéro de la ligne avec l’étiquette <code>étiquette</code>.</td>
<td></td>
</tr>
<tr class="odd">
<td><code>JMPN étiquette / JMPN n</code></td>
<td>Transfère <strong>uniquement si le contenu de l’accumulateur est négatif</strong> dans le compteur de programme <em>CP</em> le numéro de ligne <code>n</code> ou le numéro de la ligne avec l’étiquette <code>étiquette</code>.</td>
<td></td>
</tr>
<tr class="even">
<td><code>JMPP étiquette / JMPP n</code></td>
<td>Transfère <strong>uniquement si le contenu de l’accumulateur est positif</strong> dans le compteur de programme <em>CP</em> le numéro de ligne <code>n</code> ou le numéro de la ligne avec l’étiquette <code>étiquette</code>.</td>
<td></td>
</tr>
<tr class="odd">
<td><code>HALT</code></td>
<td>Stoppe l’exécution du programme.</td>
<td></td>
</tr>
<tr class="even">
<td><code>// commentaire</code></td>
<td>Ligne de commentaire non exécutée.</td>
<td></td>
</tr>
<tr class="odd">
<td><code>INSTRUCTION X ; commentaire de ligne</code></td>
<td>On peut ajouter des commentaires de lignes avec un point virgule.</td>
<td></td>
</tr>
</tbody>
</table>
<details class="appli"><summary>Multiplication d'entiers positifs</summary>
<p>Stocker deux entiers positifs quelconques dans les variables <code>X</code> et <code>Y</code>, puis sans utiliser l’opérateur <code>MUL</code>, réaliser l’opération <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>×</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex">X\times Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>
et stocker le résultat dans la case mémoire 105(variable R).</p>
<p>Pour cela on initialisera une variable <code>R</code> à 0 à laquelle on ajoutera <code>X</code> <code>Y</code> fois grâce à une boucle. A chaque tour de boucle, ajouter <code>X</code> à <code>R</code>, soustraire 1 à <code>Y</code> tant que <code>Y</code> est positif grâce à un <code>JMPP</code>.</p>
<!-- 
// X x Y sans MUL

// initialisation variables
// X = 4
LOAD #4
STO X
// Y = 5
LOAD #5
STO Y
// R = 0
LOAD #0
STO R

// boucle
boucle: LOAD R
// R = R + Y
ADD Y
STO R
// X = X-1
LOAD X
SUB #1
STO X
// boucle tant que X > 0
JMPP boucle
HALT
-->
</details>

<details class="appli"><summary>Multiplication d'entiers quelconques</summary>
<p>Adapter l’algorithme précédent grâce à une condition:</p>
<ul>
<li>Si <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>
: reprendre l’algorithme précédent.</li>
<li>Si <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y &lt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>
: soustraire <code>X</code> <code>Y</code> fois grâce à une boucle.</li>
<li>Si <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>
: terminer le programme et laisser <code>R</code> à 0.</li>
</ul>
<!-- 
// initialisation variables
// X = 4
LOAD #-4
STO X
// Y = 5
LOAD #-5
STO Y

// R = 0
LOAD #0
STO R

// Condition sur X
LOAD X
// X > 0
JMPP boucle
// X < 0
JMPN boucleneg
// X = 0
JMPZ fin

// boucle X > 0
boucle: LOAD R
// R = R + Y
LOAD R
ADD Y
STO R
// X = X-1
LOAD X
SUB #1
STO X
// boucle tant que X > 0
JMPP boucle
JMPZ fin

// boucle X < 0
boucleneg: LOAD R
// R = R + Y
LOAD R
SUB Y
STO R
// X = X + 1
LOAD X
ADD #1
STO X
// boucle tant que X > 0
JMPN boucleneg

fin: HALT
-->
</details>

<div class="ref">
<ul>
<li><p>Chapitre 1: Au cœur de l’ordinateur <a href="https://www.enseignants.hachette-education.com/livres/numerique-sciences-informatiques-1re-specialite-livre-eleve-ed-2021-9782017866305">NSI Première Hachette 2021 sous la direction de Michel Beaudouin-Lafon</a></p></li>
<li><p>Chapitre 15: L’organisation d’un ordinateur <a href="http://www.editions-eyrolles.com/Livre/9782212135435/">Informatique et sciences du numérique Spécialité ISN en terminale S - Avec des exercices corrigés et des idées de projets par Gilles Dowek</a></p></li>
</ul>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>