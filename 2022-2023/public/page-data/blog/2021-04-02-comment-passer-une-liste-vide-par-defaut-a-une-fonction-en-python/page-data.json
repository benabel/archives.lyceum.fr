{"componentChunkName":"component---src-templates-blog-md-js","path":"/blog/2021-04-02-comment-passer-une-liste-vide-par-defaut-a-une-fonction-en-python/","result":{"data":{"markdownRemark":{"html":"<h2 id=\"le-problème\" class=\"anchored\">Le problème</h2>\n<p>Il est parfois nécessaire de passer des informations lors d’appels de fonctions récursifs.</p>\n<p>Par exemple, en tentant d’implémenter la <a href=\"/tg/nsi/5-algorithmique/2-algorithmes-sur-les-graphes#rep%C3%A9rer-la-pr%C3%A9sence-dun-cycle\">recherche d’un cycle dans un graphe</a> je souhaitais passer une liste de noeuds déjà visités au rappel de la fonction pour détecter le cycle. En donnant une liste vide comme valeur par défaut je pensais pourvoir m’affranchir du rajout de la liste aux arguments lors de appels.</p>\n<div class=\"highlight\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">recherche_cycle</span><span class=\"p\">(</span><span class=\"n\">graph</span><span class=\"p\">,</span> <span class=\"n\">noeud</span><span class=\"p\">,</span> <span class=\"n\">vus</span><span class=\"o\">=</span><span class=\"p\">[])</span>\n<span class=\"o\">    ...</span>\n</pre></div>\n<p>Aurait pu s’appeler <code>recherche_cycle(g, n)</code> et non <code>recherche_cycle(g, n, [])</code>. Cependant seule la deuxième forme fonctionnait car la liste <code>vus</code> n’était pas <em>réinitialisée</em> entre deux appels.</p>\n<p><strong>Etrange non?</strong></p>\n<p>voici un exemple minimal pour comprendre ce qui se passe.</p>\n<div class=\"cell\" data-execution_count=\"1\">\n<div class=\"highlight\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">liste_vide_par_défaut</span><span class=\"p\">(</span><span class=\"n\">vus</span><span class=\"o\">=</span><span class=\"p\">[]):</span>\n<span class=\"nb\">    print</span><span class=\"p\">(</span><span class=\"s2\">\"valeur de vus au moment de l'appel:\"</span><span class=\"p\">,</span> <span class=\"n\">vus</span><span class=\"p\">)</span>\n<span class=\"n\">    vus</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">([</span><span class=\"n\">i</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)])</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n</pre></div>\n<div class=\"cell-output cell-output-stdout\">\n<div class=\"highlight\"><pre><span></span>valeur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: [0, 1, 2, 3]\nvaleur de vus au moment de l'appel: [0, 1, 2, 3, 0, 1, 2, 3]\nvaleur de vus au moment de l'appel: [0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3]\n</pre></div>\n<p>Ainsi la liste ne prend pas sa valeur par défaut à chaque appel, mais <strong>quand la définition de la fonction est executée.</strong></p>\n<p>Voici le déroulement de cette suite d’instructions dans <a href=\"http://pythontutor.com/\">pytutor</a>:</p>\n<div class=\"quarto-figure quarto-figure-center\">\n<figure class=\"figure\">\n<p><img src=\"/2022-2023/22475d9c714361c11cdae6ad100e02c9/pytutor-liste.gif\" class=\"img-fluid figure-img\"></p>\n<p></p><figcaption class=\"figure-caption\">Python tutor liste</figcaption><p></p>\n</figure>\n</div>\n<p>La <a href=\"https://docs.python.org/fr/3/reference/compound_stmts.html#function-definitions\">documentation</a> précise:</p>\n<blockquote class=\"blockquote\">\n<p>Les valeurs par défaut des paramètres sont évaluées de la gauche vers la droite quand la définition de la fonction est exécutée. Cela signifie que l’expression est évaluée une fois, lorsque la fonction est définie, et que c’est la même valeur « pré-calculée » qui est utilisée à chaque appel. C’est particulièrement important à comprendre lorsqu’un paramètre par défaut est un objet mutable, tel qu’une liste ou un dictionnaire : si la fonction modifie l’objet (par exemple en ajoutant un élément à une liste), la valeur par défaut est modifiée. En général, ce n’est pas l’effet voulu.</p>\n</blockquote>\n<h2 id=\"la-solution\" class=\"anchored\">La solution</h2>\n<p>La solution préconisée est d’utiliser <code>None</code> par défaut et de tester explicitement la valeur dans le corps de la fonction.</p>\n<div class=\"cell\" data-execution_count=\"2\">\n<div class=\"highlight\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">liste_vide_par_défaut</span><span class=\"p\">(</span><span class=\"n\">vus</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n<span class=\"k\">    if</span> <span class=\"n\">vus</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n<span class=\"n\">        vus</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"nb\">    print</span><span class=\"p\">(</span><span class=\"s2\">\"valeur de vus au moment de l'appel:\"</span><span class=\"p\">,</span> <span class=\"n\">vus</span><span class=\"p\">)</span>\n<span class=\"n\">    vus</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">([</span><span class=\"n\">i</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"mi\">4</span><span class=\"p\">)])</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">liste_vide_par_défaut</span><span class=\"p\">()</span>\n</pre></div></div>\n<div class=\"cell-output cell-output-stdout\">\n<div class=\"highlight\"><pre><span></span>valeur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: []\nvaleur de vus au moment de l'appel: []\n</pre></div>\n</div>\n</div>\n<h2 id=\"quand-utiliser-cette-solution\" class=\"anchored\">Quand utiliser cette solution?</h2>\n<p>Il faut bien comprendre que cette solution n’est nécessaire que lorsque le paramètre par défaut est mutable (listes, dictionnaire notamment).</p>\n<p>Un objet non mutable étant par construction non modifiable gradera la valeur qui lui a été donnée par défaut lors de la <em>définition de la fonction</em>.</p>\n<div class=\"cell\" data-execution_count=\"3\">\n<div class=\"highlight\"><pre><span></span><span class=\"k\">def</span> <span class=\"nf\">str_vide_par_défaut</span><span class=\"p\">(</span><span class=\"n\">txt</span><span class=\"o\">=</span><span class=\"s2\">\"\"</span><span class=\"p\">):</span>\n<span class=\"nb\">    print</span><span class=\"p\">(</span><span class=\"s2\">\"valeur de txt au moment de l'appel:\"</span><span class=\"p\">,</span> <span class=\"n\">txt</span><span class=\"p\">)</span>\n<span class=\"n\">    txt</span> <span class=\"o\">=</span> <span class=\"n\">txt</span> <span class=\"o\">+</span> <span class=\"s2\">\"0123\"</span>\n<span class=\"n\">str_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">str_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">str_vide_par_défaut</span><span class=\"p\">()</span>\n<span class=\"n\">str_vide_par_défaut</span><span class=\"p\">()</span>\n</pre></div>\n<div class=\"cell-output cell-output-stdout\">\n<div class=\"highlight\"><pre><span></span>valeur de txt au moment de l'appel: \nvaleur de txt au moment de l'appel: \nvaleur de txt au moment de l'appel: \nvaleur de txt au moment de l'appel: \n</pre></div>\n<p>Voici le déroulement de cette suite d’instructions dans <a href=\"http://pythontutor.com/\">pytutor</a>:</p>\n<div class=\"quarto-figure quarto-figure-center\">\n<figure class=\"figure\">\n<p><img src=\"/2022-2023/5c900aabcda474e6c6c500a6347d7664/pytutor-str.gif\" class=\"img-fluid figure-img\"></p>\n<p></p><figcaption class=\"figure-caption\">Python tutor liste</figcaption><p></p>\n</figure>\n</div>\n<p>Une chaîne de caractère étant immutable, l’argument par défaut reste vide.</p>","timeToRead":2,"fields":{"slug":"blog/2021-04-02-comment-passer-une-liste-vide-par-defaut-a-une-fonction-en-python/"},"frontmatter":{"author":"Benjamin Abel","tags":["python","fonction","paramètre optionnel","liste"],"title":"Comment passer une liste vide par défaut à une fonction en Python?","date":"2021-04-02T00:00:00.000Z","tocHTML":"<ul><li><a href=\"#le-problème\" data-localhref=\"true\">Le problème</a></li><li><a href=\"#la-solution\" data-localhref=\"true\">La solution</a></li><li><a href=\"#quand-utiliser-cette-solution\" data-localhref=\"true\">Quand utiliser cette solution?</a></li></ul>"}}},"pageContext":{"slug":"blog/2021-04-02-comment-passer-une-liste-vide-par-defaut-a-une-fonction-en-python/"}},"staticQueryHashes":["604483588"],"slicesMap":{}}